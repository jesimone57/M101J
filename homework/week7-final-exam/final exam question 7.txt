db.albums.createIndex({images:1})
db.images.createIndex({tags: 1})


> db.albums.find()
{ "_id" : 3, "images" : [ 1279, 1494, 1592, 2646, 3612, 5326, 6595, 7275, 8998, 9102, 10126, 10238, 10948, 11155, 11895, 11926, 12463, 13903, 13976, 15719, 16175, 16897, 18617, 19926, 21109, 22424, 23984, 23992, 24263, 28897, 29452, 29591, 30766, 31409, 33311, 34750, 38727, 41188, 43123, 43919, 44019, 45777, 47538, 50069, 52194, 55164, 55203, 55494, 59868, 60444, 60826, 61588, 61699, 63617, 65729, 66436, 67087, 67482, 68044, 68699, 68818, 72392, 72439, 73013, 73270, 73931, 74391, 74440, 75473, 76851, 77512, 79019, 79938, 80954, 81448, 82153, 83399, 83536, 84399, 86149, 87725, 88355, 88893, 91349, 91805, 95933, 97017, 97174, 97249, 98561, 99457 ] }
{ "_id" : 1, "images" : [ 120, 581, 645, 920, 2665, 3912, 4502, 9862, 10150, 10895, 11396, 11784, 11971, 14343, 14494, 16844, 18392, 19859, 19913, 21125, 22364, 23459, 27897, 28095, 30212, 31378, 31418, 32702, 33244, 34891, 35093, 36264, 36509, 37135, 37426, 38568, 39687, 40604, 41688, 42053, 42816, 43862, 44574, 44677, 46617, 48058, 49631, 49709, 51772, 52245, 52774, 53682, 54632, 54808, 55489, 56185, 56473, 58633, 59917, 60122, 60255, 60329, 60705, 60861, 62411, 62523, 62850, 64256, 66863, 67125, 68493, 68861, 70064, 71630, 72112, 73397, 73844, 75354, 76636, 77403, 77710, 79011, 79637, 79790, 80977, 82221, 83540, 83780, 88137, 88756, 89332, 89958, 91491, 92312, 92951, 94616, 95030, 96147, 96691, 97307, 97820, 98024, 99368 ] }
{ "_id" : 4, "images" : [ 91, 493, 2313, 2404, 2766, 2831, 4390, 4474, 5034, 5944, 7983, 8166, 8550, 8834, 10844, 11326, 11511, 12157, 12754, 13813, 13943, 13973, 16948, 19127, 19521, 19712, 19965, 23404, 23446, 24035, 24427, 24930, 25266, 25692, 26136, 26397, 27626, 27725, 28006, 28832, 28956, 31006, 31097, 31101, 31759, 33211, 35295, 35766, 36546, 36584, 40351, 40676, 41467, 41587, 44493, 45934, 46321, 46707, 47214, 47816, 49132, 50864, 52609, 55558, 57222, 59838, 59845, 62128, 62490, 64205, 64259, 66048, 66147, 67160, 67662, 67736, 68994, 70451, 70546, 71599, 71973, 72190, 73774, 74671, 75384, 75656, 76757, 78166, 78737, 78766, 79434, 79909, 81009, 81546, 81889, 90575, 90880, 92610, 95136, 95325, 96089, 98097, 98486 ] }


> db.images.find()
{ "_id" : 0, "height" : 480, "width" : 640, "tags" : [ "dogs", "work" ] }
{ "_id" : 4, "height" : 480, "width" : 640, "tags" : [ "dogs", "sunrises", "kittens", "travel" ] }
{ "_id" : 5, "height" : 480, "width" : 640, "tags" : [ "dogs", "cats", "sunrises", "kittens", "work" ] }
{ "_id" : 6, "height" : 480, "width" : 640, "tags" : [ "work" ] }
{ "_id" : 7, "height" : 480, "width" : 640, "tags" : [ "dogs", "sunrises" ] }
{ "_id" : 8, "height" : 480, "width" : 640, "tags" : [ "dogs", "cats", "sunrises", "kittens", "travel" ] }
{ "_id" : 2, "height" : 480, "width" : 640, "tags" : [ "dogs", "kittens", "work" ] }
{ "_id" : 9, "height" : 480, "width" : 640, "tags" : [ "dogs", "sunrises", "travel" ] }
{ "_id" : 1, "height" : 480, "width" : 640, "tags" : [ "cats", "sunrises", "kittens", "travel", "vacation", "work" ] }
{ "_id" : 10, "height" : 480, "width" : 640, "tags" : [ "cats", "kittens", "travel", "vacation", "work" ] }


db.images.find({tags: "sunrises"})

db.images.find({tags:  "sunrises"}).count()
before = 49887

loop over images
   for each image id
      if image id not found in albums tag then image is orphan ... remove it
   end
end

final count of all images should be 89,737 (we are starting with 100,000)

> db.images.find().count()
89737

db.images.find({tags:  "sunrises"}).count()
before = 44787
